<script generate>
  var md = require('markdown-it')().use(require('markdown-it-highlightjs'));
  const path = require("path");
  let docs;

  const fs = require("fs");

  const docsDir = inputs.frontMatter.docsDir

  if (!inputs.triggeredBy) {
    // get absolute paths to data files
    docs = getDataFileNames(docsDir + "/**/*.md");
  } else {
    docs = [inputs.triggeredBy];
  }

  let mapped = docs.map((filepath) => {
    const raw = fs.readFileSync(filepath, "utf8");
    const content = frontMatterParse(raw);
    const html = md.render(content.body);
    const title = content.attributes.title;
    // Use our data paths to specify output paths.
    // Data dir is the absolute path to our data dir
    // We also truncate the '.md' of path names.
    const relPath = filepath.split(dataDir + "/" +
      docsDir + "/")[1].slice(0, -3);
    return {
      path: relPath,
      data: {
        title: title,
        html: html,
      },
    };
  });

  // add index page
  mapped.push({
    path: "",
    data: {
      toc: true,
      title: "Table of Contents",
      pages: mapped.map(item => {
        return {
          url: item.path,
          title: item.data.title,
        }
      }),
    },
  })

  resolve({
    generate: mapped,
    watchGlobs: [docsDir + "/**/*.md"],
  });
</script>